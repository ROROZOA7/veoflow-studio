# API Keys Setup Guide

## Important: Veo 3 Ultra Has No API

**Google Veo 3 Ultra does NOT have an official API.** That's why VeoFlow Studio uses browser automation (Playwright) to interact with Google Flow UI.

**What this means:**
- ❌ No Veo 3 API key exists
- ✅ Video generation uses browser automation (no API key needed)
- ✅ AI API keys are ONLY for script generation (optional)

## What API Keys Are Needed?

### Required: None (for video generation)
Video rendering works **without any API keys** - it uses browser automation.

### Optional: AI API Keys (for script generation)
These are only needed if you want **automatic script generation** from prompts:
- OpenAI API key (for GPT models)
- Anthropic API key (for Claude models)  
- Gemini API key (for Google Gemini models)

**Without AI keys:** You can still create scenes manually with your own prompts and generate videos!

## Setup Instructions

### Step 1: Create `.env` File

```bash
cd veoflow-studio/backend
cp ../.env.example .env
```

### Step 2: Configure AI API Keys (Optional)

Edit `.env` file and add **ONE** of these:

**Option A: OpenAI (Recommended)**
```bash
OPENAI_API_KEY=sk-your-openai-api-key-here
AI_PROVIDER=openai
AI_MODEL=gpt-4-turbo-preview
```

**Option B: Anthropic Claude**
```bash
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here
AI_PROVIDER=anthropic
AI_MODEL=claude-3-opus-20240229
```

**Option C: Google Gemini**
```bash
GEMINI_API_KEY=your-gemini-api-key-here
AI_PROVIDER=gemini
AI_MODEL=gemini-pro
```

### Step 3: Configure Browser Settings

Edit `veoflow.config.json`:

```json
{
  "browser": {
    "headless": false,  // Set to false for first login
    "chromeProfilePath": "./chromedata"
  },
  "flow": {
    "url": "https://labs.google/fx/tools/flow/project/"
  }
}
```

### Step 4: First-Time Google Flow Login

**Important:** The first time you render a video, you need to manually log in to Google Flow.

1. Start all services (FastAPI + Celery worker)
2. Create a project and scene via API
3. Start a render: `POST /api/render/scenes/{id}/render`
4. A browser window will open
5. **Manually log in to Google Flow UI** in that browser
6. After login, cookies are saved - future renders won't need login

## How Video Generation Works (No API Key Needed!)

```mermaid
flowchart LR
    A[Your Prompt] --> B[Browser Opens]
    B --> C[Google Flow UI]
    C --> D[Inject Prompt]
    D --> E[Click Generate]
    E --> F[Wait for Video]
    F --> G[Download Video]
    
    style A fill:#e1f5ff
    style G fill:#c8e6c9
```

**The process:**
1. Your prompt → Browser automation → Google Flow UI
2. No API key needed - it simulates a real user
3. Video is generated by Google's servers
4. Browser downloads the video automatically

## Testing Video Generation

### Method 1: Without AI API Keys (Manual Prompts)

```bash
# 1. Create project
curl -X POST http://localhost:8000/api/projects \
  -H "Content-Type: application/json" \
  -d '{"name": "Test Video"}'

# Save PROJECT_ID from response

# 2. Create scene with your prompt
curl -X POST http://localhost:8000/api/scenes \
  -H "Content-Type: application/json" \
  -d '{
    "project_id": "YOUR_PROJECT_ID",
    "number": 1,
    "prompt": "A person walking through a beautiful city at sunset, cinematic wide shot, golden hour lighting"
  }'

# Save SCENE_ID from response

# 3. Render the scene (browser will open for first login)
curl -X POST "http://localhost:8000/api/render/scenes/YOUR_SCENE_ID/render?project_id=YOUR_PROJECT_ID"

# Save TASK_ID from response

# 4. Check status
curl http://localhost:8000/api/render/tasks/YOUR_TASK_ID
```

### Method 2: With AI API Keys (Automatic Script Generation)

```bash
# 1. Create project
curl -X POST http://localhost:8000/api/projects \
  -H "Content-Type: application/json" \
  -d '{"name": "AI Generated Video"}'

# Save PROJECT_ID

# 2. Generate script automatically
curl -X POST http://localhost:8000/api/projects/YOUR_PROJECT_ID/generate-script \
  -H "Content-Type: application/json" \
  -d '{"prompt": "A person walking through a beautiful city at sunset"}'

# This creates scenes automatically!

# 3. Get scenes
curl http://localhost:8000/api/scenes?project_id=YOUR_PROJECT_ID

# 4. Render a scene
curl -X POST "http://localhost:8000/api/render/scenes/YOUR_SCENE_ID/render?project_id=YOUR_PROJECT_ID"
```

## Getting API Keys

### OpenAI API Key
1. Go to https://platform.openai.com/api-keys
2. Sign up or log in
3. Click "Create new secret key"
4. Copy the key (starts with `sk-`)

### Anthropic API Key
1. Go to https://console.anthropic.com/
2. Sign up or log in
3. Navigate to API Keys
4. Create a new key
5. Copy the key (starts with `sk-ant-`)

### Gemini API Key
1. Go to https://makersuite.google.com/app/apikey
2. Sign in with Google account
3. Create API key
4. Copy the key

## Configuration Files

### `.env` File (Environment Variables)
```bash
# AI Services (Optional - only for script generation)
OPENAI_API_KEY=sk-your-key-here
# OR
ANTHROPIC_API_KEY=sk-ant-your-key-here
# OR
GEMINI_API_KEY=your-key-here

# Database (defaults to SQLite)
DATABASE_URL=sqlite:///./veoflow.db

# Redis (defaults to localhost)
REDIS_URL=redis://localhost:6379/0

# Browser
BROWSER_HEADLESS=false  # false for first login, true after
CHROME_PROFILE_PATH=./chromedata

# Flow URL
FLOW_URL=https://labs.google/fx/tools/flow/project/
```

### `veoflow.config.json` (Application Config)
```json
{
  "ai": {
    "provider": "openai",  // or "anthropic" or "gemini"
    "model": "gpt-4-turbo-preview",
    "apiKey": "",  // Leave empty, uses .env instead
    "temperature": 0.7,
    "maxTokens": 2000
  }
}
```

## Testing Your Setup

### Test 1: Check API Key Configuration

```bash
cd veoflow-studio/backend
source venv/bin/activate
python -c "
from app.services.script_generator import ScriptGenerator
sg = ScriptGenerator()
if sg.api_key:
    print(f'✓ API key configured: {sg.provider}')
else:
    print('⚠ No API key - script generation will be skipped')
    print('  Video rendering still works without API keys!')
"
```

### Test 2: Test Script Generation (if API key set)

```bash
curl -X POST http://localhost:8000/api/projects/YOUR_PROJECT_ID/generate-script \
  -H "Content-Type: application/json" \
  -d '{"prompt": "A short test video"}'
```

### Test 3: Test Video Rendering (no API key needed)

```bash
# Create scene manually
curl -X POST http://localhost:8000/api/scenes \
  -H "Content-Type: application/json" \
  -d '{
    "project_id": "YOUR_PROJECT_ID",
    "number": 1,
    "prompt": "A person walking, cinematic shot"
  }'

# Render it
curl -X POST "http://localhost:8000/api/render/scenes/YOUR_SCENE_ID/render?project_id=YOUR_PROJECT_ID"
```

## First Video Generation Checklist

- [ ] Redis is running (`docker ps | grep redis`)
- [ ] FastAPI server is running (`curl http://localhost:8000/health`)
- [ ] Celery worker is running (check terminal)
- [ ] Browser automation ready (Playwright installed)
- [ ] `.env` file created (even if empty)
- [ ] `headless: false` in config (for first login)
- [ ] Google account ready for manual login

## Summary

**For Video Generation:**
- ✅ **No API keys needed** - uses browser automation
- ✅ Just need Google account (manual login first time)
- ✅ Works immediately after setup

**For Script Generation:**
- ⚠️ **Optional** - only if you want AI-generated scripts
- ⚠️ Need OpenAI/Anthropic/Gemini API key
- ⚠️ Without it, create scenes manually with your prompts

**Bottom Line:** You can generate videos RIGHT NOW without any API keys! Just create scenes manually and render them.

